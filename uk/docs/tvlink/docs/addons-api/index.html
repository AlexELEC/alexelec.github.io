<!DOCTYPE html>
<html lang="uk" dir="ltr">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="
  Общие сведения.
  #

Репозиторий с готовыми плагинами (которые можно использовать как примеры) находится здесь.
Для создания своего или установки готового аддона активируйте &ldquo;Addon sources&rdquo; и нажмите кнопку &ldquo;Add Addon&rdquo; (на странице &ldquo;Sources&rdquo;).
Вам будет предложено ввести имя (латинские буквы без пробелов и спец. символов) нового аддона.
Если аддон с таким именем есть в репозитории (имя файла без расширения &ldquo;.py&rdquo;) он будет автоматически установлен и активирован.
Если такого аддона нет в репозитории, для него будет создана обертка.">
<meta name="theme-color" media="(prefers-color-scheme: light)" content="#ffffff">
<meta name="theme-color" media="(prefers-color-scheme: dark)" content="#343a40">
<meta name="color-scheme" content="light dark"><meta property="og:url" content="https://alexelec.github.io/uk/docs/tvlink/docs/addons-api/">
  <meta property="og:site_name" content="AlexELEC">
  <meta property="og:title" content="TVLINK addons API">
  <meta property="og:description" content="Общие сведения. # Репозиторий с готовыми плагинами (которые можно использовать как примеры) находится здесь.
Для создания своего или установки готового аддона активируйте “Addon sources” и нажмите кнопку “Add Addon” (на странице “Sources”).
Вам будет предложено ввести имя (латинские буквы без пробелов и спец. символов) нового аддона.
Если аддон с таким именем есть в репозитории (имя файла без расширения “.py”) он будет автоматически установлен и активирован.
Если такого аддона нет в репозитории, для него будет создана обертка.">
  <meta property="og:locale" content="uk">
  <meta property="og:type" content="article">
    <meta property="article:section" content="docs">
<title>TVLINK addons API | AlexELEC</title>
<link rel="icon" href="/icon.png" >
<link rel="manifest" href="/manifest.json">
<link rel="canonical" href="https://alexelec.github.io/uk/docs/tvlink/docs/addons-api/">
<link rel="stylesheet" href="/book.min.e9f68c3fff3d8236a489d16a9caf6de5e4d1a29c20eb4b5524e42cd30be4d319.css" integrity="sha256-6faMP/89gjakidFqnK9t5eTRopwg60tVJOQs0wvk0xk=" crossorigin="anonymous">
  <script defer src="/fuse.min.js"></script>
  <script defer src="/uk.search.min.31d2ac636d23652cffe8b710b06766753478ee2e16a0e99dcd3805074ffb7525.js" integrity="sha256-MdKsY20jZSz/6LcQsGdmdTR47i4WoOmdzTgFB0/7dSU=" crossorigin="anonymous"></script>

  <script defer src="/sw.min.6f6f90fcb8eb1c49ec389838e6b801d0de19430b8e516902f8d75c3c8bd98739.js" integrity="sha256-b2&#43;Q/LjrHEnsOJg45rgB0N4ZQwuOUWkC&#43;NdcPIvZhzk=" crossorigin="anonymous"></script>
<!--
Made with Book Theme
https://github.com/alex-shpak/hugo-book
-->
  
</head>
<body dir="ltr">
  <input type="checkbox" class="hidden toggle" id="menu-control" />
  <input type="checkbox" class="hidden toggle" id="toc-control" />
  <main class="container flex">
    <aside class="book-menu">
      <div class="book-menu-content">
        
  <nav>
<h2 class="book-brand">
  <a class="flex align-center" href="/uk/"><img src="/icon.png" alt="Logo" class="book-icon" /><span>AlexELEC</span>
  </a>
</h2>


<div class="book-search hidden">
  <input type="text" id="book-search-input" placeholder="Пошук" aria-label="Пошук" maxlength="64" data-hotkeys="s/" />
  <div class="book-search-spinner hidden"></div>
  <ul id="book-search-results"></ul>
</div>
<script>document.querySelector(".book-search").classList.remove("hidden")</script>



  





<ul class="book-languages">
  <li>
    <input type="checkbox" id="languages" class="toggle" />
    <label for="languages" class="flex justify-between">
      <a role="button" class="flex align-center">
        <img src="/svg/translate.svg" class="book-icon" alt="Languages" />
        Українська
      </a>
    </label>

    <ul>
      
    </ul>
  </li>
</ul>














  
  <ul>
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-be8cf2fedc7fdcca58ae0597a4bbe13e" class="toggle" checked />
    <label for="section-be8cf2fedc7fdcca58ae0597a4bbe13e" class="flex justify-between">
      <a role="button" class="">TVLINK</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/uk/docs/tvlink/docs/overview/" class="">Огляд</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/uk/docs/tvlink/docs/install/" class="">Встановлення та оновлення</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/uk/docs/tvlink/docs/quick-start/" class="">Швидкий старт</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/uk/docs/tvlink/docs/srv-config/" class="">Налаштування сервера та потоків</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/uk/docs/tvlink/docs/source/" class="">Налаштування джерел каналів</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/uk/docs/tvlink/docs/epg/" class="">Розклад передач (EPG)</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/uk/docs/tvlink/docs/profiles/" class="">Профілі користувачів</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/uk/docs/tvlink/docs/channels/" class="">Канали</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/uk/docs/tvlink/docs/gpoups/" class="">Групи каналів</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/uk/docs/tvlink/docs/status/" class="">Статус роботи та оновлення програми</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/uk/docs/tvlink/docs/pvr-tvlink-client/" class="">PVR TVLINK Client</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/uk/docs/tvlink/docs/tvlink-simple-conrol/" class="">TVLINK Simple Control</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/uk/docs/tvlink/docs/addons-api/" class="active">TVLINK addons API</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
  </ul>










  
<ul>
  
  <li>
    <a href="/uk/posts/"  >
        Новини
      </a>
  </li>
  
</ul>






</nav>




  <script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script>


 
      </div>
    </aside>

    <div class="book-page">
      <header class="book-header">
        
  <div class="flex align-center justify-between">
  <label for="menu-control">
    <img src="/svg/menu.svg" class="book-icon" alt="Menu" />
  </label>

  <h3>TVLINK addons API</h3>

  <label for="toc-control">
    
    <img src="/svg/toc.svg" class="book-icon" alt="Table of Contents" />
    
  </label>
</div>


  
  <aside class="hidden clearfix">
    
  
<nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#общие-сведения">Общие сведения.</a></li>
      </ul>
    </li>
    <li><a href="#---coding-utf-8---">-<em>- coding: utf-8 -</em>-</a></li>
    <li><a href="#---coding-utf-8----1">-<em>- coding: utf-8 -</em>-</a></li>
  </ul>
</nav>



  </aside>
  
 
      </header>

      
      
  <article class="markdown book-article"><h2 id="общие-сведения">
  Общие сведения.
  <a class="anchor" href="#%d0%be%d0%b1%d1%89%d0%b8%d0%b5-%d1%81%d0%b2%d0%b5%d0%b4%d0%b5%d0%bd%d0%b8%d1%8f">#</a>
</h2>
<p>Репозиторий с готовыми плагинами (которые можно использовать как примеры) находится здесь.</p>
<p>Для создания своего или установки готового аддона активируйте &ldquo;Addon sources&rdquo; и нажмите кнопку &ldquo;Add Addon&rdquo; (на странице &ldquo;Sources&rdquo;).</p>
<p>Вам будет предложено ввести имя (латинские буквы без пробелов и спец. символов) нового аддона.</p>
<p>Если аддон с таким именем есть в репозитории (имя файла без расширения &ldquo;.py&rdquo;) он будет автоматически установлен и активирован.</p>
<p>Если такого аддона нет в репозитории, для него будет создана обертка.</p>
<p>В каталоге &ldquo;/путь_к_tvlink/scrapers&rdquo; появиться пустой файл нового аддона. В нашем примере это - &ldquo;tvlink/scrapers/Test.py&rdquo;. После того как Вы напишите код плагина (в файле Test.py), его можно активировать и использовать.</p>
<p>Addons API.</p>
<p>В плагине обязательно должен быть подключен модуль &ldquo;utils&rdquo; (из TVLINK) который предоставляет нужные функции
Цитировать (выделенное)</p>
<h1 id="---coding-utf-8---">
  -<em>- coding: utf-8 -</em>-
  <a class="anchor" href="#---coding-utf-8---">#</a>
</h1>
<p>import os, sys</p>
<p>root_dir = os.path.dirname(sys.argv[0])
sys.path.append(root_dir)</p>
<p>import utils</p>
<p>и должен быть определен класс &ldquo;Scraper&rdquo; с такими обязательными функциями (выделены жирным)</p>
<p>Цитировать (выделенное)
class Scraper:
def <strong>init</strong>(self):  # опционально, <strong>init</strong> можно не использовать
self.source = &lsquo;Test&rsquo;
self.link = &rsquo;ext:{0}:&rsquo;.format(self.source)
self.headers = {&lsquo;User-Agent&rsquo;: &lsquo;Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:86.0) Gecko/20100101 Firefox/86.0&rsquo;}</p>
<pre><code>def getHeaders(self):
    return self.headers

def Channels(self):
    LL = []
    # LL = ( (0-chID, 1-chTitle, 2-chGroup, 3-chUrl, 4-chLogo), ...)
    ...
    utils.ch_inputs_DB(self.source, LL)

def getLink(self, lnk):
    ...
    return lnk
</code></pre>
<p>Итак, в классе &ldquo;Scraper&rdquo; должны обязательно присутствовать функции: Channels(), getHeaders() и getLink(). Все остальное на Ваше усмотрение, Вы можете определить дополнительно любые классы, функции, переменные как в области видимости Scraper так и глобально.</p>
<p>Пройдемся по функциям в порядке их использования.</p>
<p>Channels() - будет вызвана TVLINK когда нужно составить &ldquo;карту каналов&rdquo;, например, когда вы нажимаете кнопку &ldquo;Update&rdquo; источника (плагина).</p>
<p>Основное действие для TVLINK происходит в строке:
Код
utils.ch_inputs_DB(self.source, LL)
Функция utils.ch_inputs_DB() (также обязательна) - принимает два аргумента:</p>
<pre><code>1) имя источника (должно совпадать с именем файла-аддона), self.source - в примере
2) список кортежей в котором перечислены параметры канала, LL - в примере
</code></pre>
<p>Кортеж должен быть сформирован в таком формате и порядке:</p>
<p>Код
LL = ( (0-chID, 1-chTitle, 2-chGroup, 3-chUrl, 4-chLogo), )
chID - идентификатор канала
chTitle - имя канала
chGroup - группа канала
chUrl - url канала
chLogo - url иконки канала</p>
<p>Из обязательного здесь: chID, chTitle и chUrl. По сути, Вам из сайта (для которого Вы пишите плагин) нужно взять как минимум два значения - chTitle и chUrl.
Для получения chID нужно использовать функцию utils.title_to_crc32(chTitle) которая вернет идентификатор канала на основе аргумента chTitle.
Все остальные переменные могут содержать пустую строку.</p>
<p>В общем случае, функция Channels() используется для получения и парсинга страницы сайта, чтобы заполнить кортеж переменными (0-chID, 1-chTitle, 2-chGroup, 3-chUrl, 4-chLogo) и передать его функции utils.ch_inputs_DB(). Нет ни каких ограничений на то, каким именно способом Вы получите эти значения, но &ldquo;идентификатор канала&rdquo; Вы должны получить именно через функцию - utils.title_to_crc32(chTitle).</p>
<p>Второй важный момент.
chUrl (url канала) - должен быть сформирован в следующем формате:</p>
<p>Код
ext:имя_аддона:http://ссылка_на_канал.html
Например, если аддон называется &ldquo;Telehub&rdquo; а ссылка на нужный канал - &ldquo;
  <a href="http://telehub.org/amedia-hit.html%22">http://telehub.org/amedia-hit.html"</a>, то chUrl у нас будет выглядеть так:</p>
<p>Код
ext:Telehub:http://telehub.org/amedia-hit.html
Когда TVLINK включает канал по этой ссылке, он понимает (по префиксу &ldquo;ext:Telehub&rdquo;), что он должен вызвать функцию getLink() из аддона &ldquo;Telehub&rdquo; и передать ей в качестве аргумента ссылку - &ldquo;
  <a href="http://telehub.org/amedia-hit.html%22">http://telehub.org/amedia-hit.html"</a>.
Таким образом мы плавно подходим к функции getLink()&hellip;</p>
<p>getLink() - будет вызвана когда Вы включаете канал из Вашего аддона и должна вернуть реальный адрес потока.</p>
<p>Если Вы пишите аддон для сайта где опубликованы статические ссылки на потоки, вид этой функции будет такой (что получил - то и отдал):</p>
<p>Код
def getLink(self, lnk):
return lnk
На практике такое встречается крайне редко. Обычно ссылки на поток формируются на сайте динамически при открытии страницы канала, причем каждый раз новые.
В этой функции Вы должны найти такую ссылку и вернуть ее TVLINK чтобы он смог ее &ldquo;проиграть&rdquo;. Опять же, способы этого добиться - ограничены только Вашей фантазией, главное верните ссылку на поток.</p>
<p>Модуль &ldquo;utils&rdquo; из TVLINK предоставляет несколько вспомогательных функций которые Вы можете использовать в своем плагине и в частности в функциях Channels() и getLink() чтобы ускорить написание кода.</p>
<p>utils.getURL(url, headers=None, referer=None) - возвращает страницу (сайта) по указанному адресу (url).</p>
<p>Только url-аргумент является обязательным.
Если указан только url-аргумент, в запрос будет добавлен заголовок {&lsquo;User-Agent&rsquo;: &lsquo;Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:86.0) Gecko/20100101 Firefox/86.0&rsquo;}.
Если в дополнение к User-Agent (по умолчанию) Вам нужно передать заголовок Referer сделайте так (referer=&lsquo;строка&rsquo;):</p>
<p>Код
html = utils.getURL(&lsquo;
  <a href="http://telehub.org/amedia-hit.html%27">http://telehub.org/amedia-hit.html'</a>, referer=&lsquo;
  <a href="http://telehub.org">http://telehub.org</a>&rsquo;)
Если этих заголовков не достаточно или User-Agent по умолчанию не подходит - задайте аргумент &ldquo;headers&rdquo; (словарь) где опишите все что нужно, например:</p>
<p>Код
headers = {&lsquo;User-Agent&rsquo;: &lsquo;SmartSDK/1.5.63-rt-25&rsquo;,
&lsquo;Accept&rsquo;: &rsquo;text/html,application/xhtml+xml,application/xml;q=0.9,<em>/</em>;q=0.8&rsquo;,
&lsquo;Accept-Language&rsquo;: &lsquo;ru-RU,ru;q=0.8,en-US;q=0.5,en;q=0.3&rsquo;,
&lsquo;Referer&rsquo;: &lsquo;
  <a href="http://site.org">http://site.org</a>&rsquo;}</p>
<p>html = utils.getURL(&lsquo;
  <a href="http://site.org/amedia-hit.html%27">http://site.org/amedia-hit.html'</a>, headers=headers)</p>
<p>utils.mfind(html, start_string, end_string) - ищет в строке (html) начальную (start_string) и конечную (end_string) строки и возвращает найденное между ними. Например как здесь.</p>
<p>getHeaders() - последняя обязательная функция класса &ldquo;Scraper&rdquo;. Вызывается когда TVLINK открывает поток и должна вернуть заголовки (словарь) которые требуются для запроса потока.</p>
<p>То есть, мы маскируемся под браузер когда открываем поток:</p>
<p>Код
def getHeaders(self):
headers = {&lsquo;User-Agent&rsquo;: &lsquo;Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:86.0) Gecko/20100101 Firefox/86.0&rsquo;,
&lsquo;Accept&rsquo;: &rsquo;text/html,application/xhtml+xml,application/xml;q=0.9,<em>/</em>;q=0.8&rsquo;,
&lsquo;Accept-Language&rsquo;: &lsquo;ru-RU,ru;q=0.8,en-US;q=0.5,en;q=0.3&rsquo;,
&lsquo;Referer&rsquo;: &lsquo;
  <a href="http://site.org">http://site.org</a>&rsquo;}
return headers</p>
<p>Для парсинга страниц сайта удобно использовать модуль &ldquo;BeautifulSoup&rdquo;.
Если Вы хотите использовать этот модуль в своем плагине - его нужно подключить. Делается это так:</p>
<p>Цитировать (выделенное)</p>
<h1 id="---coding-utf-8----1">
  -<em>- coding: utf-8 -</em>-
  <a class="anchor" href="#---coding-utf-8----1">#</a>
</h1>
<p>import os, sys</p>
<p>root_dir = os.path.dirname(sys.argv[0])
libs_dir = os.path.join(root_dir, &rsquo;libs&rsquo;)
ssv_file = os.path.join(libs_dir, &lsquo;soupsieve.whl&rsquo;)
bs4_file = os.path.join(libs_dir, &lsquo;beautifulsoup.whl&rsquo;)</p>
<p>sys.path.append(root_dir)
sys.path.append(libs_dir)
sys.path.insert(0, ssv_file)
sys.path.insert(0, bs4_file)</p>
<p>import utils
from bs4 import BeautifulSoup</p>
</article>
 
      

      <footer class="book-footer">
        
  <div class="flex flex-wrap justify-between">





</div>



  <script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){if(window.getSelection().toString())return;e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script>


 
        
      </footer>

      
  
  <div class="book-comments">

</div>
  
 

      <label for="menu-control" class="hidden book-menu-overlay"></label>
    </div>

    
    <aside class="book-toc">
      <div class="book-toc-content">
        
  
<nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#общие-сведения">Общие сведения.</a></li>
      </ul>
    </li>
    <li><a href="#---coding-utf-8---">-<em>- coding: utf-8 -</em>-</a></li>
    <li><a href="#---coding-utf-8----1">-<em>- coding: utf-8 -</em>-</a></li>
  </ul>
</nav>


 
      </div>
    </aside>
    
  </main>

  
</body>
</html>












